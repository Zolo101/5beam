diff --git a/dist/index.esm.js b/dist/index.esm.js
index d1e216a63a6993be9f4476c9cafac675cc99c881..6383e76a72720b7ea2612061079e7f5b2ebcefe1 100644
--- a/dist/index.esm.js
+++ b/dist/index.esm.js
@@ -1 +1 @@
-var c={par:""},l={and:"&&",or:"||"},a={eq:"=",neq:"!=",gt:">",gte:">=",lt:"<",lte:"<=",like:"~",nlike:"!~",any:"?=",nany:"?!=",anygt:"?>",anygte:"?>=",anylt:"?<",anylte:"?<=",anylike:"?~",nanylike:"?!~"},g={par:"par",and:"or",or:"and",eq:"neq",gt:"lte",gte:"lt",lt:"gte",lte:"gt",like:"nlike",any:"nany",anygt:"anylte",anygte:"anylt",anylt:"anygte",anylte:"anygt",anylike:"nanylike",neq:"eq",nany:"any",nanylike:"anylike",nlike:"like"};function E(e){let n=(...o)=>{let r=o.filter(Boolean);if(r.length===0)return null;let i={op:e};for(let p=0;p<r.length;p++){let u=r[p],F=u.op in l;if(!i.lhs){i.lhs=u;continue}if(i.lhs&&i.rhs){let O=i;i={lhs:F?O:y(O),op:e}}i.rhs=u}return i},t=(...o)=>n(...o);return t.maybe=n,t}var ne=E("and"),C=E("or");function _(e){let n=o=>o?e(o):null,t=e;return t.maybe=n,t}function L(e){return _(n=>"filter"in n&&n.op in c?n:{op:e,filter:n})}var y=L("par"),d=_(e=>"op"in e&&"filter"in e?e:"field"in e?{...e,op:g[e.op]}:{...e,lhs:d(e.lhs),op:g[e.op],rhs:d(e.rhs)});function s(e){let n=(r,i)=>({op:e,field:r,value:i}),t=(r,i)=>i?n(r,i):null,o=(r,i)=>C.maybe(...i.map(p=>t(r,p)));return n.maybe=t,n.either=(r,i)=>o(r,i),n.maybeEither=o,n}var S=s("eq"),re=s("gt"),te=s("gte"),ie=s("lt"),oe=s("lte"),le=s("like"),se=s("any"),ae=s("anygt"),pe=s("anygte"),ue=s("anylt"),ce=s("anylte"),ye=s("anylike"),Oe=e=>d(S(e,""));function x(e){return n=>n in e}var b=x(c),T=x(l),I=x(a);function he(e){return b(e)?c[e]:T(e)?l[e]:I(e)?a[e]:""}function ke(e){for(let n in c)if(c[n]==e)return n;for(let n in l)if(l[n]==e)return n;for(let n in a)if(a[n]==e)return n;return""}var R=Object.values(l).map(e=>e.replace("||","\\|\\|")),m="@?\\w+(?:\\.\\w+)*(?::[a-z_]+)?",A=Object.values(a).sort((e,n)=>e.length<n.length?1:e.length===n.length?0:-1).map(e=>e.replace("?","\\?")),N=`""|''|".+"|'.+'`,P="[+-]?[0-9]*[.]?[0-9]+",w="true|false",M="null",v="\\{:\\S+\\}",$="\\(|\\)",V=[R,A,$].map(e=>Array.isArray(e)?e.join("|"):e),G=[v,w,M,P,m,N],B=[...V,...G],K={"-2":"eof","-1":"unknown",1:"logical_op",2:"comparison_op",3:"container_op",4:"placeholder",5:"boolean",6:"null",7:"number",8:"field",9:"string"},W=()=>new RegExp(B.map(e=>`(${e})`).join("|"),"g");function D(e,n){return{input:e,lexer:W(),index:0,prevToken:null,currentToken:null,nextToken:null,params:n,consume(t,o){let r=this.currentToken;if(Array.isArray(t))if(r){if(!t.includes(r.kind))throw new Error(`Expected either ${t.join(", ")}. Got ${r.value} (${r.kind})`)}else throw new Error(`Expected either ${t.join(", ")}. Got null`);else if(t)if(r){if(t!==r.kind)throw new Error(`Expected ${t}. Got ${r.value} (${r.kind})`)}else throw new Error(`Expected ${t}. Got null`);if(o&&r&&o!==r.value)throw new Error(`Expected ${o}. Got ${r.value} (${r.kind})`);return this.next(),r},next(){let t=this.lexer.exec(e);this.prevToken=this.currentToken,this.currentToken=this.nextToken;let o=t?.findIndex((i,p)=>p>0&&i)??-1;if(!t||o===-1||!t[o])return this.index++,this.nextToken=null,this.currentToken;let r=this.input.indexOf(t[o],this.index);if(r>this.index&&r-this.index>=1){let i=this.input.substring(this.index,r);if(i.indexOf(" ")===-1||i.indexOf(" ")!==-1&&!i.endsWith(" "))return this.nextToken=null,this.currentToken}return this.nextToken={kind:K[o]??"unknown",value:t[o]},this.index=r+t[o].length,this.currentToken}}}function h(e){if(!e.currentToken)throw new Error(`Invalid filter: ${e.input}`);switch(e.currentToken.kind){case"field":return U(e);case"container_op":return q(e);default:throw new Error(`Invalid token: ${e.currentToken.value} (${e.currentToken.kind})`)}}function U(e){let n=e.consume("field"),t=e.consume("comparison_op"),o=Object.keys(a).find(u=>a[u]===t.value);if(!o)throw new Error("Unexpected error happened while parsing logical filter.");let r=e.consume(["boolean","field","string","number","null","placeholder"]),i;switch(r.kind){case"placeholder":let u=r.value.substring(2,r.value.length-1);i=e.params[u]??null;break;case"field":i=r.value;break;case"string":if(r.value.startsWith("'")&&r.value.endsWith("'")){let F=r.value.indexOf("'"),O=r.value.lastIndexOf("'");i=r.value.substring(F+1,O);break}default:i=JSON.parse(r.value)}let p={op:o,field:n.value,value:i};return k(e,p)}function j(e,n){let o=e.consume("logical_op").value,r=h(e),i=Object.keys(l).find(u=>l[u]===o);if(!i)throw new Error("Unexpected error happened while parsing logical filter.");return k(e,{op:i,lhs:n,rhs:r})}function k(e,n){return e.currentToken&&e.currentToken.kind==="logical_op"?j(e,"lhs"in n?y(n):n):n}function q(e){e.consume("container_op","(");let n=h(e);return e.consume("container_op",")"),n=y(n),k(e,n)}function X(e,n={}){let t=D(e.trim(),n);return t.consume(),t.consume(),h(t)}var J=new RegExp("^"+m+"$");function Y(e){return e===null?"null":e instanceof Date?JSON.stringify(e.toISOString().replace("T"," ")):JSON.stringify(e)}function f(e){if(!e)return"";if("filter"in e)return`(${f(e.filter)})`;if("field"in e){let o=Y(e.value);if(!J.test(e.field))throw new Error(`Invalid field: ${e.field}`);return`${e.field} ${a[e.op]} ${o}`}let n=f("lhs"in e.lhs?y(e.lhs):e.lhs),t=f("lhs"in e.rhs?y(e.rhs):e.rhs);return`${n} ${l[e.op]} ${t}`}export{a as COMPARISON_OPS,c as CONTAINER_OPS,g as INVERSE_OPS,l as LOGICAL_OPS,ne as and,se as any,ae as anygt,pe as anygte,ye as anylike,ue as anylt,ce as anylte,S as eq,ke as getOpBySymbol,he as getSymbolByOp,re as gt,te as gte,I as isOpComparison,b as isOpContainer,T as isOpLogical,le as like,ie as lt,oe as lte,d as not,Oe as notEmpty,C as or,y as par,X as parse,f as stringify};
+var c={par:""},l={and:"&&",or:"||"},a={eq:"=",neq:"!=",gt:">",gte:">=",lt:"<",lte:"<=",like:"~",nlike:"!~",any:"?=",nany:"?!=",anygt:"?>",anygte:"?>=",anylt:"?<",anylte:"?<=",anylike:"?~",nanylike:"?!~"},g={par:"par",and:"or",or:"and",eq:"neq",gt:"lte",gte:"lt",lt:"gte",lte:"gt",like:"nlike",any:"nany",anygt:"anylte",anygte:"anylt",anylt:"anygte",anylte:"anygt",anylike:"nanylike",neq:"eq",nany:"any",nanylike:"anylike",nlike:"like"};function E(e){let n=(...o)=>{let r=o.filter(Boolean);if(r.length===0)return null;if(r.length===1)return r[0];let i={op:e};for(let p=0;p<r.length;p++){let u=r[p],F=u.op in l;if(!i.lhs){i.lhs=u;continue}if(i.lhs&&i.rhs){let O=i;i={lhs:F?O:y(O),op:e}}i.rhs=u}return i},t=(...o)=>n(...o);return t.maybe=n,t}var ne=E("and"),C=E("or");function _(e){let n=o=>o?e(o):null,t=e;return t.maybe=n,t}function L(e){return _(n=>"filter"in n&&n.op in c?n:{op:e,filter:n})}var y=L("par"),d=_(e=>"op"in e&&"filter"in e?e:"field"in e?{...e,op:g[e.op]}:{...e,lhs:d(e.lhs),op:g[e.op],rhs:d(e.rhs)});function s(e){let n=(r,i)=>({op:e,field:r,value:i}),t=(r,i)=>i?n(r,i):null,o=(r,i)=>C.maybe(...i.map(p=>t(r,p)));return n.maybe=t,n.either=(r,i)=>o(r,i),n.maybeEither=o,n}var S=s("eq"),re=s("gt"),te=s("gte"),ie=s("lt"),oe=s("lte"),le=s("like"),se=s("any"),ae=s("anygt"),pe=s("anygte"),ue=s("anylt"),ce=s("anylte"),ye=s("anylike"),Oe=e=>d(S(e,""));function x(e){return n=>n in e}var b=x(c),T=x(l),I=x(a);function he(e){return b(e)?c[e]:T(e)?l[e]:I(e)?a[e]:""}function ke(e){for(let n in c)if(c[n]==e)return n;for(let n in l)if(l[n]==e)return n;for(let n in a)if(a[n]==e)return n;return""}var R=Object.values(l).map(e=>e.replace("||","\\|\\|")),m="@?\\w+(?:\\.\\w+)*(?::[a-z_]+)?",A=Object.values(a).sort((e,n)=>e.length<n.length?1:e.length===n.length?0:-1).map(e=>e.replace("?","\\?")),N=`""|''|".+"|'.+'`,P="[+-]?[0-9]*[.]?[0-9]+",w="true|false",M="null",v="\\{:\\S+\\}",$="\\(|\\)",V=[R,A,$].map(e=>Array.isArray(e)?e.join("|"):e),G=[v,w,M,P,m,N],B=[...V,...G],K={"-2":"eof","-1":"unknown",1:"logical_op",2:"comparison_op",3:"container_op",4:"placeholder",5:"boolean",6:"null",7:"number",8:"field",9:"string"},W=()=>new RegExp(B.map(e=>`(${e})`).join("|"),"g");function D(e,n){return{input:e,lexer:W(),index:0,prevToken:null,currentToken:null,nextToken:null,params:n,consume(t,o){let r=this.currentToken;if(Array.isArray(t))if(r){if(!t.includes(r.kind))throw new Error(`Expected either ${t.join(", ")}. Got ${r.value} (${r.kind})`)}else throw new Error(`Expected either ${t.join(", ")}. Got null`);else if(t)if(r){if(t!==r.kind)throw new Error(`Expected ${t}. Got ${r.value} (${r.kind})`)}else throw new Error(`Expected ${t}. Got null`);if(o&&r&&o!==r.value)throw new Error(`Expected ${o}. Got ${r.value} (${r.kind})`);return this.next(),r},next(){let t=this.lexer.exec(e);this.prevToken=this.currentToken,this.currentToken=this.nextToken;let o=t?.findIndex((i,p)=>p>0&&i)??-1;if(!t||o===-1||!t[o])return this.index++,this.nextToken=null,this.currentToken;let r=this.input.indexOf(t[o],this.index);if(r>this.index&&r-this.index>=1){let i=this.input.substring(this.index,r);if(i.indexOf(" ")===-1||i.indexOf(" ")!==-1&&!i.endsWith(" "))return this.nextToken=null,this.currentToken}return this.nextToken={kind:K[o]??"unknown",value:t[o]},this.index=r+t[o].length,this.currentToken}}}function h(e){if(!e.currentToken)throw new Error(`Invalid filter: ${e.input}`);switch(e.currentToken.kind){case"field":return U(e);case"container_op":return q(e);default:throw new Error(`Invalid token: ${e.currentToken.value} (${e.currentToken.kind})`)}}function U(e){let n=e.consume("field"),t=e.consume("comparison_op"),o=Object.keys(a).find(u=>a[u]===t.value);if(!o)throw new Error("Unexpected error happened while parsing logical filter.");let r=e.consume(["boolean","field","string","number","null","placeholder"]),i;switch(r.kind){case"placeholder":let u=r.value.substring(2,r.value.length-1);i=e.params[u]??null;break;case"field":i=r.value;break;case"string":if(r.value.startsWith("'")&&r.value.endsWith("'")){let F=r.value.indexOf("'"),O=r.value.lastIndexOf("'");i=r.value.substring(F+1,O);break}default:i=JSON.parse(r.value)}let p={op:o,field:n.value,value:i};return k(e,p)}function j(e,n){let o=e.consume("logical_op").value,r=h(e),i=Object.keys(l).find(u=>l[u]===o);if(!i)throw new Error("Unexpected error happened while parsing logical filter.");return k(e,{op:i,lhs:n,rhs:r})}function k(e,n){return e.currentToken&&e.currentToken.kind==="logical_op"?j(e,"lhs"in n?y(n):n):n}function q(e){e.consume("container_op","(");let n=h(e);return e.consume("container_op",")"),n=y(n),k(e,n)}function X(e,n={}){let t=D(e.trim(),n);return t.consume(),t.consume(),h(t)}var J=new RegExp("^"+m+"$");function Y(e){return e===null?"null":e instanceof Date?JSON.stringify(e.toISOString().replace("T"," ")):JSON.stringify(e)}function f(e){if(!e)return"";if("filter"in e)return`(${f(e.filter)})`;if("field"in e){let o=Y(e.value);if(!J.test(e.field))throw new Error(`Invalid field: ${e.field}`);return`${e.field} ${a[e.op]} ${o}`}let n=f("lhs"in e.lhs?y(e.lhs):e.lhs),t=f("lhs"in e.rhs?y(e.rhs):e.rhs);return`${n} ${l[e.op]} ${t}`}export{a as COMPARISON_OPS,c as CONTAINER_OPS,g as INVERSE_OPS,l as LOGICAL_OPS,ne as and,se as any,ae as anygt,pe as anygte,ye as anylike,ue as anylt,ce as anylte,S as eq,ke as getOpBySymbol,he as getSymbolByOp,re as gt,te as gte,I as isOpComparison,b as isOpContainer,T as isOpLogical,le as like,ie as lt,oe as lte,d as not,Oe as notEmpty,C as or,y as par,X as parse,f as stringify};
diff --git a/dist/index.js b/dist/index.js
index 0ddb3e9d11a7ad9e6807d91fa3635ad60751bd12..1a019f3a43d987d9bc4e1d08b09a4f015c2287d3 100644
--- a/dist/index.js
+++ b/dist/index.js
@@ -1 +1 @@
-"use strict";var x=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var P=Object.prototype.hasOwnProperty;var w=(e,n)=>{for(var t in n)x(e,t,{get:n[t],enumerable:!0})},M=(e,n,t,o)=>{if(n&&typeof n=="object"||typeof n=="function")for(let r of N(n))!P.call(e,r)&&r!==t&&x(e,r,{get:()=>n[r],enumerable:!(o=A(n,r))||o.enumerable});return e};var v=e=>M(x({},"__esModule",{value:!0}),e);var xe={};w(xe,{COMPARISON_OPS:()=>s,CONTAINER_OPS:()=>c,INVERSE_OPS:()=>F,LOGICAL_OPS:()=>l,and:()=>$,any:()=>U,anygt:()=>j,anygte:()=>q,anylike:()=>Y,anylt:()=>X,anylte:()=>J,eq:()=>S,getOpBySymbol:()=>Q,getSymbolByOp:()=>H,gt:()=>G,gte:()=>B,isOpComparison:()=>I,isOpContainer:()=>b,isOpLogical:()=>T,like:()=>D,lt:()=>K,lte:()=>W,not:()=>g,notEmpty:()=>z,or:()=>C,par:()=>y,parse:()=>R,stringify:()=>O});module.exports=v(xe);var c={par:""},l={and:"&&",or:"||"},s={eq:"=",neq:"!=",gt:">",gte:">=",lt:"<",lte:"<=",like:"~",nlike:"!~",any:"?=",nany:"?!=",anygt:"?>",anygte:"?>=",anylt:"?<",anylte:"?<=",anylike:"?~",nanylike:"?!~"},F={par:"par",and:"or",or:"and",eq:"neq",gt:"lte",gte:"lt",lt:"gte",lte:"gt",like:"nlike",any:"nany",anygt:"anylte",anygte:"anylt",anylt:"anygte",anylte:"anygt",anylike:"nanylike",neq:"eq",nany:"any",nanylike:"anylike",nlike:"like"};function _(e){let n=(...o)=>{let r=o.filter(Boolean);if(r.length===0)return null;let i={op:e};for(let p=0;p<r.length;p++){let u=r[p],d=u.op in l;if(!i.lhs){i.lhs=u;continue}if(i.lhs&&i.rhs){let f=i;i={lhs:d?f:y(f),op:e}}i.rhs=u}return i},t=(...o)=>n(...o);return t.maybe=n,t}var $=_("and"),C=_("or");function L(e){let n=o=>o?e(o):null,t=e;return t.maybe=n,t}function V(e){return L(n=>"filter"in n&&n.op in c?n:{op:e,filter:n})}var y=V("par"),g=L(e=>"op"in e&&"filter"in e?e:"field"in e?{...e,op:F[e.op]}:{...e,lhs:g(e.lhs),op:F[e.op],rhs:g(e.rhs)});function a(e){let n=(r,i)=>({op:e,field:r,value:i}),t=(r,i)=>i?n(r,i):null,o=(r,i)=>C.maybe(...i.map(p=>t(r,p)));return n.maybe=t,n.either=(r,i)=>o(r,i),n.maybeEither=o,n}var S=a("eq"),G=a("gt"),B=a("gte"),K=a("lt"),W=a("lte"),D=a("like"),U=a("any"),j=a("anygt"),q=a("anygte"),X=a("anylt"),J=a("anylte"),Y=a("anylike"),z=e=>g(S(e,""));function m(e){return n=>n in e}var b=m(c),T=m(l),I=m(s);function H(e){return b(e)?c[e]:T(e)?l[e]:I(e)?s[e]:""}function Q(e){for(let n in c)if(c[n]==e)return n;for(let n in l)if(l[n]==e)return n;for(let n in s)if(s[n]==e)return n;return""}var Z=Object.values(l).map(e=>e.replace("||","\\|\\|")),h="@?\\w+(?:\\.\\w+)*(?::[a-z_]+)?",ee=Object.values(s).sort((e,n)=>e.length<n.length?1:e.length===n.length?0:-1).map(e=>e.replace("?","\\?")),ne=`""|''|".+"|'.+'`,re="[+-]?[0-9]*[.]?[0-9]+",te="true|false",ie="null",oe="\\{:\\S+\\}",le="\\(|\\)",se=[Z,ee,le].map(e=>Array.isArray(e)?e.join("|"):e),ae=[oe,te,ie,re,h,ne],pe=[...se,...ae],ue={"-2":"eof","-1":"unknown",1:"logical_op",2:"comparison_op",3:"container_op",4:"placeholder",5:"boolean",6:"null",7:"number",8:"field",9:"string"},ce=()=>new RegExp(pe.map(e=>`(${e})`).join("|"),"g");function ye(e,n){return{input:e,lexer:ce(),index:0,prevToken:null,currentToken:null,nextToken:null,params:n,consume(t,o){let r=this.currentToken;if(Array.isArray(t))if(r){if(!t.includes(r.kind))throw new Error(`Expected either ${t.join(", ")}. Got ${r.value} (${r.kind})`)}else throw new Error(`Expected either ${t.join(", ")}. Got null`);else if(t)if(r){if(t!==r.kind)throw new Error(`Expected ${t}. Got ${r.value} (${r.kind})`)}else throw new Error(`Expected ${t}. Got null`);if(o&&r&&o!==r.value)throw new Error(`Expected ${o}. Got ${r.value} (${r.kind})`);return this.next(),r},next(){let t=this.lexer.exec(e);this.prevToken=this.currentToken,this.currentToken=this.nextToken;let o=t?.findIndex((i,p)=>p>0&&i)??-1;if(!t||o===-1||!t[o])return this.index++,this.nextToken=null,this.currentToken;let r=this.input.indexOf(t[o],this.index);if(r>this.index&&r-this.index>=1){let i=this.input.substring(this.index,r);if(i.indexOf(" ")===-1||i.indexOf(" ")!==-1&&!i.endsWith(" "))return this.nextToken=null,this.currentToken}return this.nextToken={kind:ue[o]??"unknown",value:t[o]},this.index=r+t[o].length,this.currentToken}}}function k(e){if(!e.currentToken)throw new Error(`Invalid filter: ${e.input}`);switch(e.currentToken.kind){case"field":return Oe(e);case"container_op":return Fe(e);default:throw new Error(`Invalid token: ${e.currentToken.value} (${e.currentToken.kind})`)}}function Oe(e){let n=e.consume("field"),t=e.consume("comparison_op"),o=Object.keys(s).find(u=>s[u]===t.value);if(!o)throw new Error("Unexpected error happened while parsing logical filter.");let r=e.consume(["boolean","field","string","number","null","placeholder"]),i;switch(r.kind){case"placeholder":let u=r.value.substring(2,r.value.length-1);i=e.params[u]??null;break;case"field":i=r.value;break;case"string":if(r.value.startsWith("'")&&r.value.endsWith("'")){let d=r.value.indexOf("'"),f=r.value.lastIndexOf("'");i=r.value.substring(d+1,f);break}default:i=JSON.parse(r.value)}let p={op:o,field:n.value,value:i};return E(e,p)}function fe(e,n){let o=e.consume("logical_op").value,r=k(e),i=Object.keys(l).find(u=>l[u]===o);if(!i)throw new Error("Unexpected error happened while parsing logical filter.");return E(e,{op:i,lhs:n,rhs:r})}function E(e,n){return e.currentToken&&e.currentToken.kind==="logical_op"?fe(e,"lhs"in n?y(n):n):n}function Fe(e){e.consume("container_op","(");let n=k(e);return e.consume("container_op",")"),n=y(n),E(e,n)}function R(e,n={}){let t=ye(e.trim(),n);return t.consume(),t.consume(),k(t)}var ge=new RegExp("^"+h+"$");function de(e){return e===null?"null":e instanceof Date?JSON.stringify(e.toISOString().replace("T"," ")):JSON.stringify(e)}function O(e){if(!e)return"";if("filter"in e)return`(${O(e.filter)})`;if("field"in e){let o=de(e.value);if(!ge.test(e.field))throw new Error(`Invalid field: ${e.field}`);return`${e.field} ${s[e.op]} ${o}`}let n=O("lhs"in e.lhs?y(e.lhs):e.lhs),t=O("lhs"in e.rhs?y(e.rhs):e.rhs);return`${n} ${l[e.op]} ${t}`}0&&(module.exports={COMPARISON_OPS,CONTAINER_OPS,INVERSE_OPS,LOGICAL_OPS,and,any,anygt,anygte,anylike,anylt,anylte,eq,getOpBySymbol,getSymbolByOp,gt,gte,isOpComparison,isOpContainer,isOpLogical,like,lt,lte,not,notEmpty,or,par,parse,stringify});
+"use strict";var x=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var P=Object.prototype.hasOwnProperty;var w=(e,n)=>{for(var t in n)x(e,t,{get:n[t],enumerable:!0})},M=(e,n,t,o)=>{if(n&&typeof n=="object"||typeof n=="function")for(let r of N(n))!P.call(e,r)&&r!==t&&x(e,r,{get:()=>n[r],enumerable:!(o=A(n,r))||o.enumerable});return e};var v=e=>M(x({},"__esModule",{value:!0}),e);var xe={};w(xe,{COMPARISON_OPS:()=>s,CONTAINER_OPS:()=>c,INVERSE_OPS:()=>F,LOGICAL_OPS:()=>l,and:()=>$,any:()=>U,anygt:()=>j,anygte:()=>q,anylike:()=>Y,anylt:()=>X,anylte:()=>J,eq:()=>S,getOpBySymbol:()=>Q,getSymbolByOp:()=>H,gt:()=>G,gte:()=>B,isOpComparison:()=>I,isOpContainer:()=>b,isOpLogical:()=>T,like:()=>D,lt:()=>K,lte:()=>W,not:()=>g,notEmpty:()=>z,or:()=>C,par:()=>y,parse:()=>R,stringify:()=>O});module.exports=v(xe);var c={par:""},l={and:"&&",or:"||"},s={eq:"=",neq:"!=",gt:">",gte:">=",lt:"<",lte:"<=",like:"~",nlike:"!~",any:"?=",nany:"?!=",anygt:"?>",anygte:"?>=",anylt:"?<",anylte:"?<=",anylike:"?~",nanylike:"?!~"},F={par:"par",and:"or",or:"and",eq:"neq",gt:"lte",gte:"lt",lt:"gte",lte:"gt",like:"nlike",any:"nany",anygt:"anylte",anygte:"anylt",anylt:"anygte",anylte:"anygt",anylike:"nanylike",neq:"eq",nany:"any",nanylike:"anylike",nlike:"like"};function _(e){let n=(...o)=>{let r=o.filter(Boolean);if(r.length===0)return null;if(r.length===1)return r[0];let i={op:e};for(let p=0;p<r.length;p++){let u=r[p],d=u.op in l;if(!i.lhs){i.lhs=u;continue}if(i.lhs&&i.rhs){let f=i;i={lhs:d?f:y(f),op:e}}i.rhs=u}return i},t=(...o)=>n(...o);return t.maybe=n,t}var $=_("and"),C=_("or");function L(e){let n=o=>o?e(o):null,t=e;return t.maybe=n,t}function V(e){return L(n=>"filter"in n&&n.op in c?n:{op:e,filter:n})}var y=V("par"),g=L(e=>"op"in e&&"filter"in e?e:"field"in e?{...e,op:F[e.op]}:{...e,lhs:g(e.lhs),op:F[e.op],rhs:g(e.rhs)});function a(e){let n=(r,i)=>({op:e,field:r,value:i}),t=(r,i)=>i?n(r,i):null,o=(r,i)=>C.maybe(...i.map(p=>t(r,p)));return n.maybe=t,n.either=(r,i)=>o(r,i),n.maybeEither=o,n}var S=a("eq"),G=a("gt"),B=a("gte"),K=a("lt"),W=a("lte"),D=a("like"),U=a("any"),j=a("anygt"),q=a("anygte"),X=a("anylt"),J=a("anylte"),Y=a("anylike"),z=e=>g(S(e,""));function m(e){return n=>n in e}var b=m(c),T=m(l),I=m(s);function H(e){return b(e)?c[e]:T(e)?l[e]:I(e)?s[e]:""}function Q(e){for(let n in c)if(c[n]==e)return n;for(let n in l)if(l[n]==e)return n;for(let n in s)if(s[n]==e)return n;return""}var Z=Object.values(l).map(e=>e.replace("||","\\|\\|")),h="@?\\w+(?:\\.\\w+)*(?::[a-z_]+)?",ee=Object.values(s).sort((e,n)=>e.length<n.length?1:e.length===n.length?0:-1).map(e=>e.replace("?","\\?")),ne=`""|''|".+"|'.+'`,re="[+-]?[0-9]*[.]?[0-9]+",te="true|false",ie="null",oe="\\{:\\S+\\}",le="\\(|\\)",se=[Z,ee,le].map(e=>Array.isArray(e)?e.join("|"):e),ae=[oe,te,ie,re,h,ne],pe=[...se,...ae],ue={"-2":"eof","-1":"unknown",1:"logical_op",2:"comparison_op",3:"container_op",4:"placeholder",5:"boolean",6:"null",7:"number",8:"field",9:"string"},ce=()=>new RegExp(pe.map(e=>`(${e})`).join("|"),"g");function ye(e,n){return{input:e,lexer:ce(),index:0,prevToken:null,currentToken:null,nextToken:null,params:n,consume(t,o){let r=this.currentToken;if(Array.isArray(t))if(r){if(!t.includes(r.kind))throw new Error(`Expected either ${t.join(", ")}. Got ${r.value} (${r.kind})`)}else throw new Error(`Expected either ${t.join(", ")}. Got null`);else if(t)if(r){if(t!==r.kind)throw new Error(`Expected ${t}. Got ${r.value} (${r.kind})`)}else throw new Error(`Expected ${t}. Got null`);if(o&&r&&o!==r.value)throw new Error(`Expected ${o}. Got ${r.value} (${r.kind})`);return this.next(),r},next(){let t=this.lexer.exec(e);this.prevToken=this.currentToken,this.currentToken=this.nextToken;let o=t?.findIndex((i,p)=>p>0&&i)??-1;if(!t||o===-1||!t[o])return this.index++,this.nextToken=null,this.currentToken;let r=this.input.indexOf(t[o],this.index);if(r>this.index&&r-this.index>=1){let i=this.input.substring(this.index,r);if(i.indexOf(" ")===-1||i.indexOf(" ")!==-1&&!i.endsWith(" "))return this.nextToken=null,this.currentToken}return this.nextToken={kind:ue[o]??"unknown",value:t[o]},this.index=r+t[o].length,this.currentToken}}}function k(e){if(!e.currentToken)throw new Error(`Invalid filter: ${e.input}`);switch(e.currentToken.kind){case"field":return Oe(e);case"container_op":return Fe(e);default:throw new Error(`Invalid token: ${e.currentToken.value} (${e.currentToken.kind})`)}}function Oe(e){let n=e.consume("field"),t=e.consume("comparison_op"),o=Object.keys(s).find(u=>s[u]===t.value);if(!o)throw new Error("Unexpected error happened while parsing logical filter.");let r=e.consume(["boolean","field","string","number","null","placeholder"]),i;switch(r.kind){case"placeholder":let u=r.value.substring(2,r.value.length-1);i=e.params[u]??null;break;case"field":i=r.value;break;case"string":if(r.value.startsWith("'")&&r.value.endsWith("'")){let d=r.value.indexOf("'"),f=r.value.lastIndexOf("'");i=r.value.substring(d+1,f);break}default:i=JSON.parse(r.value)}let p={op:o,field:n.value,value:i};return E(e,p)}function fe(e,n){let o=e.consume("logical_op").value,r=k(e),i=Object.keys(l).find(u=>l[u]===o);if(!i)throw new Error("Unexpected error happened while parsing logical filter.");return E(e,{op:i,lhs:n,rhs:r})}function E(e,n){return e.currentToken&&e.currentToken.kind==="logical_op"?fe(e,"lhs"in n?y(n):n):n}function Fe(e){e.consume("container_op","(");let n=k(e);return e.consume("container_op",")"),n=y(n),E(e,n)}function R(e,n={}){let t=ye(e.trim(),n);return t.consume(),t.consume(),k(t)}var ge=new RegExp("^"+h+"$");function de(e){return e===null?"null":e instanceof Date?JSON.stringify(e.toISOString().replace("T"," ")):JSON.stringify(e)}function O(e){if(!e)return"";if("filter"in e)return`(${O(e.filter)})`;if("field"in e){let o=de(e.value);if(!ge.test(e.field))throw new Error(`Invalid field: ${e.field}`);return`${e.field} ${s[e.op]} ${o}`}let n=O("lhs"in e.lhs?y(e.lhs):e.lhs),t=O("lhs"in e.rhs?y(e.rhs):e.rhs);return`${n} ${l[e.op]} ${t}`}0&&(module.exports={COMPARISON_OPS,CONTAINER_OPS,INVERSE_OPS,LOGICAL_OPS,and,any,anygt,anygte,anylike,anylt,anylte,eq,getOpBySymbol,getSymbolByOp,gt,gte,isOpComparison,isOpContainer,isOpLogical,like,lt,lte,not,notEmpty,or,par,parse,stringify});
